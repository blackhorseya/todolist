# UseCase 層

這個目錄負責協調與實現應用層的業務流程，根據 Clean Architecture 與 Domain-Driven Design 的原則，將應用邏輯劃分為不同類型的用例。主要分為以下四個子目錄：

- **command**：命令操作  
  處理狀態修改與指令執行。這些用例通常會改變系統的狀態，例如新增、更新或刪除操作。每個命令用例都應該封裝必要的驗證與業務邏輯，並與領域模型進行互動。

- **query**：查詢操作  
  專注於讀取數據，實現 CQRS 模式中的查詢側。查詢用例負責從資料庫、快取或其他來源中獲取數據，並返回專門設計的讀模型。這部分不修改狀態，而是用於支持高效、靈活的數據讀取需求。

- **behaviour**：複雜領域行為  
  封裝跨多個操作或領域模型的複雜業務流程。這裡的用例通常涉及多步驟流程或需要協調多個領域服務，並實現特定的業務規則。這部分能夠將複雜行為獨立出來，保持
  Command 與 Query 層的簡潔。

- **event**：事件處理  
  處理領域事件及其後續反應。當系統中某些核心事件發生時，這些用例會觸發相應的事件處理流程（例如異步通知、後續補償操作等），以實現事件驅動架構。

## 如何使用

1. **新增用例：**
    - 當需要新增一個狀態修改操作，請將對應的業務流程實現在 `command` 子目錄下，並確保該用例能夠封裝所有必要的驗證與領域邏輯。
    - 若需新增查詢操作，請在 `query` 子目錄中實現查詢用例，返回專用的讀取模型，並確保查詢邏輯不改變系統狀態。
    - 如果某個業務流程涉及多步驟或跨領域協同，請考慮在 `behaviour` 中進行封裝。
    - 對於需要響應領域事件的操作，請在 `event` 目錄中新增事件處理用例。

2. **用例調用流程：**
    - 上層（例如 delivery 層或應用入口）會調用 usecase 層中的相應用例，這些用例負責協調各個領域服務、 repository
      與外部系統，並返回最終結果。
    - 用例層應盡量保持輕量，將業務規則封裝在 domain 層，而用例層僅負責流程調用與數據整合。

3. **測試與擴展：**
    - 每個用例都應該提供相應的單元測試，確保各個流程正確執行。
    - 隨著業務需求擴展，可以逐步擴充各子目錄內的用例，並保持內部 API 的穩定與一致。

## 範例結構

```
internal/usecase/
├── command
│   └── sample_command.go      // 命令操作範例（例如創建或更新操作）
├── query
│   └── sample_query.go        // 查詢操作範例（例如根據條件查詢數據）
├── behaviour
│   └── sample_behaviour.go    // 複雜業務流程範例（例如多步驟協調）
└── event
    └── sample_event.go        // 事件處理範例（例如領域事件通知）
```

## 小結

UseCase 層作為應用邏輯的核心調度中心，負責協調各個領域服務與外部依賴。通過將用例劃分為 Command、Query、Behaviour 與 Event
四個部分，可以更清晰地管理和擴展系統的業務流程，從而保持架構的清晰與靈活性。